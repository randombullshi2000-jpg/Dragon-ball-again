/**
 * Pixel Art Sprite Definitions
 * 32x32 sprites defined as 32-character strings Ã— 32 rows
 * Each character maps to a color in SPRITE_PALETTE
 *
 * Characters:
 *  . = transparent
 *  k = hair black
 *  K = hair dark
 *  s = skin
 *  S = skin shadow
 *  D = skin dark
 *  o = orange gi
 *  O = orange gi dark
 *  b = blue gi
 *  B = blue gi dark
 *  w = white
 *  W = white dark
 *  r = red
 *  g = green
 *  e = eye (dark)
 *  m = mouth
 *  t = teeth
 *  n = brown/dirt
 *  N = dark brown
 *  p = purple
 *  y = yellow
 *  a = aura blue
 *  A = aura bright
 *  x = ground/shadow
 *  c = cloud white
 *  G = grass green
 *  T = tree green dark
 */

const SPRITE_PALETTE = {
  '.': null,
  'k': '#1a1a2e',  // hair black
  'K': '#2c2c3e',  // hair dark
  's': '#f4a261',  // skin
  'S': '#d4845c',  // skin shadow
  'D': '#a05c28',  // skin dark
  'o': '#e8772c',  // orange gi
  'O': '#bf5e1a',  // orange gi dark
  'b': '#3d6fbc',  // blue gi
  'B': '#2b4d8a',  // blue gi dark
  'w': '#e8e8e8',  // white
  'W': '#c0c0c0',  // white dark
  'r': '#c0392b',  // red
  'g': '#27ae60',  // green
  'e': '#0a0a1e',  // eye dark
  'm': '#c0392b',  // mouth
  't': '#f0f0f0',  // teeth
  'n': '#7d5a3c',  // brown
  'N': '#4a3020',  // dark brown
  'p': '#8e44ad',  // purple
  'y': '#f4d03f',  // yellow
  'a': '#4db8ff',  // ki aura blue
  'A': '#a8d8ff',  // ki aura bright
  'x': '#0a0a1e',  // shadow
  'c': '#d4e8f0',  // cloud
  'G': '#4a8c3f',  // grass dark
  'T': '#2d6a2d',  // tree dark
  'P': '#f9c0e0',  // pink (cherry blossom)
  'Y': '#f7dc6f',  // bright yellow
  'R': '#e74c3c',  // bright red
  'C': '#f0f0ff',  // cloud bright
  'M': '#8b6914',  // mountain
  'H': '#888888',  // grey
  'L': '#b8860b',  // dark gold
  'Z': '#2c3e50',  // dark slate
  'F': '#ff6b35',  // fire orange
  'V': '#9b59b6',  // violet
  'Q': '#1abc9c',  // teal
  'I': '#e8f8ff',  // ice blue
  'U': '#f39c12',  // amber
  'J': '#16a085',  // dark teal
  'X': '#2980b9',  // water blue
};

// Helper: parse a sprite string into a 2D array of colors
function parseSprite(str) {
  const rows = str.trim().split('\n');
  return rows.map(row => {
    const out = [];
    for (let i = 0; i < 32; i++) {
      const ch = row[i] || '.';
      out.push(SPRITE_PALETTE[ch] || null);
    }
    return out;
  });
}

// =====================================================================
// KAZE SPRITES (protagonist)
// =====================================================================

// Stage 1: Wild child (PL 3-15) - torn shorts, messy hair, skinny
const RAW = {

KAZE_IDLE: `
................................
................................
................................
................................
.............kkkk...............
............kkKkkk..............
...........kk.ss.kk.............
...........k.ssse.k.............
...........k.ssss.k.............
............ksSmsk..............
.............nnnn...............
...........nnnnnnnn.............
..........n.n....n.n............
..........n.n....n.n............
...........n.nnnn.n.............
............n....n..............
...........n......n.............
..........n........n............
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

KAZE_RUN1: `
................................
................................
................................
................................
.............kkkk...............
............kkKkkk..............
...........kk.ss.kk.............
........kk.k.ssse.k.............
........k...k.ssss.k............
........k...ksSmsk..............
........k...nnnnn...............
.......kk.nnnnnnnnn.............
.......k..n.n.......n...........
.......k..n.n........n..........
........n.n.nnnnn....n..........
.........n...............n......
..........n.................n...
...............................n.
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

KAZE_PUNCH: `
................................
................................
................................
................................
.............kkkk...............
............kkKkkk..............
...........kk.ss.kk.............
...........k.ssse.k.....ssssss..
...........k.ssss.kk.ssssssss...
............ksSmsk.ksssss.......
.............nnnn.k.............
.........knnnnnnnn..............
.........kn.n....n.n............
.........kn.n....n.n............
..........n.n.nnnn.n............
...........n...n................
..........n....n................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

KAZE_JUMP: `
................................
................................
.............kkkk...............
............kkKkkk..............
...........kk.ss.kk.............
...........k.ssse.k.............
...........k.ssss.k.............
............ksSmsk..............
.............nnnn...............
...........nnnnnnnn.............
..........n.n....n.n............
..........n.n....n.n............
..........nn.nnnn.nn............
.........n..........n...........
........n............n..........
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

KAZE_HURT: `
................................
................................
................................
................................
.............kkkk...............
...........kkkkKkkk.............
..........kk..ss..kk............
..........k..sssE..k............
..........k..ssss..k............
...........kssSSmsk.............
............nnnnn...............
..........nnnnnnnnn.............
.........n.n.....n.n............
.........n.n.....n.n............
..........n.n.nnn.n.............
.........n..n...n...............
........n....n...n..............
.......n..........................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

// Stage 2: Aspiring Student (PL 16-40) - clean blue gi
KAZE_GI_IDLE: `
................................
................................
................................
................................
.............kkkk...............
............kKkkKk..............
...........k.ssss.k.............
...........k.sese.k.............
...........k.ssss.k.............
............kssSmk..............
.............bbbb...............
...........bbbbbbbb.............
..........bb.ww.bb..............
..........bB.ww.bB..............
..........bb.bbbbb..............
..........bB....bB..............
..........bb....bb..............
..........bbbbbbb...............
..........bB...bB...............
..........bb...bb...............
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

// Stage 3/4: Orange gi (PL 41+)
KAZE_OGI_IDLE: `
................................
................................
................................
................................
.............kkkk...............
............kKkkKk..............
...........k.ssss.k.............
...........k.sese.k.............
...........k.ssss.k.............
............kssSmk..............
............woooow..............
..........woooooooow............
.........wo.w..w.ow.............
.........wO.w..w.Ow.............
.........wo.ooooo.o.............
.........wO....o.Ow.............
.........wo....o.ow.............
.........woooooo.w..............
.........wO...oOow..............
.........wo...oow...............
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

KAZE_OGI_RUN1: `
................................
................................
................................
................................
.............kkkk...............
............kKkkKk..............
...........k.ssss.k.............
...........k.sese.k.............
...........k.ssss.k.............
............kssSmk..............
............woooow..............
..........woooooooow............
.........wo...........w.........
.........wO...........Ow........
.........woooooooooooo..........
.........w.....o................
.........w.....o................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

KAZE_OGI_KICK: `
................................
................................
................................
................................
.............kkkk...............
............kKkkKk..............
...........k.ssss.k.............
...........k.sese.k.............
...........k.ssss.k.............
............kssSmk..............
............woooow..............
..........woooooooow............
.........wo.w..w.ow.............
.........wO.w..w.Ow.............
.........wo.ooooo.o.............
.........wO...Ow................
.........wo..ow.................
.........woow...................
........wnnnnnnnnnnnnnn.........
......wnnnnnnnnnnnnnnnn.........
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

KAZE_KAMEHAMEHA: `
................................
................................
................................
................................
.............kkkk...............
............kKkkKk..............
...........k.ssss.k.............
...........k.sese.k.............
...........k.ssss.k.............
............kssSmk..............
............woooow..............
.....aaa..woooooooow............
....aAAAa.wo.w..w.ow............
...aAAaAAAswO.w..w.Ow...........
..aAAAAAAAswo.ooooo.o...........
.aAAAAAAAaswO....o.Ow...........
aAAAAAAAAa.wo....o.ow...........
.aAAAAAAAa.woooooo.w............
..aAAAAAAa.wO...oOow............
...aAAAa...wo...oow.............
....aaa.........................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

KAZE_POWERUP: `
................................
.............aaa................
............aAAAa...............
...........aAA.AAa..............
..........aAA...AAa.............
.........aA......Aa.............
.........aA.kkkk.Aa.............
.........aA.kKkKk.Aa............
.........aA.ssss..Aa............
.........aA.seseA.Aa............
.........aA.sAssA.Aa............
.......aAkssAsmAk..Aa...........
.......aAkkkkAkkkk.Aa...........
.......aA.woAoAoow.Aa...........
.......aA.wAoAAoAw.Aa...........
.......aA.woAoooow.Aa...........
........aA.Awooow.Aa............
.........aA.AAaAA.Aa............
..........aA.aAa.Aa.............
...........aA.A.Aa..............
............aAAAa...............
.............aaa................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

// =====================================================================
// MASTER ROSHI
// =====================================================================
ROSHI_IDLE: `
................................
................................
................................
................................
..............wwww..............
.............wwWwww.............
............ww.ss.ww............
.............w.ss.w.............
.............w.se.w.............
.............wssSsw.............
..............wmmw..............
.............bbbbb..............
...........bbbbbbbbbb...........
..........bb.n.nnn.nbb..........
..........bB.n.nnn.nbB..........
...........bb.nnnnn.bb..........
...........bBbbbbbbbB...........
...........bb.......bb..........
...........bBnnnnnnnbB..........
...........bbbbbbbbbbbb.........
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

// =====================================================================
// YAMCHA
// =====================================================================
YAMCHA_IDLE: `
................................
................................
................................
................................
.............kkkk...............
............kKKKkk..............
...........k.ssss.k.............
...........k.sese.k.............
...........k.ssss.k.............
............kssSmk..............
.............oooo...............
...........oooooooo.............
..........o.ww..ww.o............
..........O.ww..ww.O............
..........o.ooooo..o............
..........O.....o..O............
..........o.....o..o............
..........ooooooo...............
..........O...oOo...............
..........o...oo................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

// =====================================================================
// ENEMY: WOLF
// =====================================================================
WOLF_IDLE: `
................................
................................
................................
................................
..........kk.....kk.............
.........kWWk...kWWk............
........kWWWWkkkWWWWk...........
........kWWWWWWWWWWWk...........
........kWeWWWWWWWeWk...........
.........kWWWmmWWWk.............
..........kkkkkkkkk.............
.........kWWWWWWWWk.............
........kWWWWWWWWWWk............
.......kWW..WWWW..WWk...........
......kWW...WWWW...WWk..........
......kWW..kWWWWk..WWk..........
......kWWW..WWWW..WWWk..........
......kWWWWWWWWWWWWWk...........
.......kkWWWWWWWWWkk............
.........kkkkkkkk...............
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

// =====================================================================
// ENEMY: BANDIT
// =====================================================================
BANDIT_IDLE: `
................................
................................
................................
................................
.............rrrr...............
............rrrrrrr.............
...........rr.ss.rr.............
...........r.ssee.r.............
...........r.ssss.r.............
............rssSmr..............
.............nnnn...............
.........nnnnnnnnnn.............
........nn.nn....nn.nn..........
........nN.nn....nn.nN..........
........nn.nnnnnnn.nn...........
........nN....nnn..nN...........
........nn....nnn..nn...........
........nnnnnnn.....nn..........
........nN.....n....nN..........
........nn.....n....nn..........
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................
................................`,

// =====================================================================
// TILES (16x16)
// =====================================================================
TILE_GRASS: `
GgGgGgGgGgGgGgGg
GgggGGggGGgGgGGg
gGGgGgGgGgGGGgGg
GgGgNnNnNnNnNnGg
nnNnnNnnNnnNnnNn
NnNnNnNnNnNnNnNn
NNnNnNnNNnNNnNnN
nNNnNNNnNnNNnNNn
nNnnNnnnNNnnNNnn
NnNnNnNnNnNnNnNn
NNnNnNnNNnNNnNnN
NnNNnNNnNnNNnNNn
nNNnNNNnNNnNNnNn
NnNnNnNnNnNnNnNn
nNNnNNnNnNNnNNnN
NnNnNnNnNnNnNnNn`,

TILE_DIRT: `
nNnNnNnNnNnNnNnN
NnnNNnNnNnnNNnNn
nNNnNNNnNnNNnNNn
NnNnNnNnNnNnNnNn
NNNNNnNnNNNNNnNn
nNnNnNnNnNnNnNnN
NnnNNnNnNnnNNnNn
nNNnNNNnNnNNnNNn
NnNnNnNnNnNnNnNn
nNnNnNnNnNnNnNnN
NNNNNnNnNNNNNnNn
nNnNnNnNnNnNnNnN
NnnNNnNnNnnNNnNn
nNNnNNNnNnNNnNNn
NnNnNnNnNnNnNnNn
nNnNnNnNnNnNnNnN`,

TILE_STONE: `
HHHHHHHHHHHHHHHH
HZZZHZZZZZZZHhHH
HZZZHZZZZZZZHhHH
HHHHHHHHHHHHHhHH
HhHHHZZZZHHHHHHH
HhHHHZZZZHHHHHHH
HhHHHZZZZHHHHhHH
HHHHHHHHHHHHHhHH
HHhHHHHHHHHHHhHH
HHhHHZZZZZHHHHHH
HHhHHZZZZZHHHHHH
HHHHHZZZZZHHHHHH
HHHHHHHHHHHHhHHH
HhHHHHHHHHHHhHHH
HhHHZZZZHHHHHHHH
HHHHHHHHHHHHHHHH`,

TILE_WATER: `
XXXXaXXXXXXXXXXX
XXXaaXXXaXXXXaXX
XaXXXXXXXXXaXXXX
XXXXXaXXXXXXXXaX
XaXXXXXXaXXXXXXX
XXXaXXXXXXXaXXXX
XXXXXXaXXXXXXXXa
XaXXXXXXXaXXXXXX
XXXXaXXXXXXXaXXX
XXXXXXXaXXXXXXXX
XaXXXXXXXXXaXXXX
XXXXaXXXXXXXXXaX
XXXXXXXaXXXXXXXX
XaXXXXXXXaXXXXXX
XXXXaXXXXXXXXaXX
XXXXXXXXXaXXXXXX`,

TILE_CLOUD: `
................
.......CCCC.....
......CCCCCC....
.....CCCCCCCC...
....CCCCCCCCCC..
...CCCCCCCCCCCC.
..CCCCCCCCCCCCCC
.CCCCCCCCCCCCCCC
.CCCCCCCCCCCCCCC
..CCCCCCCCCCCCCC
...CCCCCCCCCCCCC
....CCCCCCCCCCCC
.....CCCCCCCCCC.
......CCCCCCC...
.......CCCCC....
................`,

};

// Parse all sprites
const SPRITES = {};
for (const [name, data] of Object.entries(RAW)) {
  SPRITES[name] = parseSprite(data);
}

// Renderer: draw a sprite to canvas context
// x, y = canvas position of top-left, scale = pixel size
function drawSprite(ctx, sprite, x, y, scale = C.SPRITE_SCALE, flipX = false) {
  if (!sprite) return;
  const size = scale;
  ctx.save();
  if (flipX) {
    ctx.translate(x + sprite[0].length * size, y);
    ctx.scale(-1, 1);
    x = 0;
    y = 0;
  }
  for (let row = 0; row < sprite.length; row++) {
    for (let col = 0; col < sprite[row].length; col++) {
      const color = sprite[row][col];
      if (color) {
        ctx.fillStyle = color;
        ctx.fillRect(
          (flipX ? 0 : x) + col * size,
          (flipX ? 0 : y) + row * size,
          size, size
        );
      }
    }
  }
  ctx.restore();
}

// Draw a tile (16x16 sprite at any position)
function drawTile(ctx, tile, x, y, scale = C.SCALE) {
  drawSprite(ctx, tile, x, y, scale);
}

// Draw sprite with glow effect (for ki/aura)
function drawSpriteGlow(ctx, sprite, x, y, scale, color, radius = 4) {
  ctx.save();
  ctx.shadowColor = color;
  ctx.shadowBlur = radius * scale;
  drawSprite(ctx, sprite, x, y, scale);
  ctx.restore();
}
